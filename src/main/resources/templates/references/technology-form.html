<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<!--/*@thymesVar id="technologyTo" type="ru.javaprojects.projector.references.TechnologyTo"*/-->

<th:block th:replace="~{fragments/main::page(title='Technologies',appMain=~{::appMain}, ownScript=~{::ownScript}, activeMenuItem=${ {'technologies', 'management', 'references'} })}">
    <appMain>
        <h2 class="text-secondary font-weight-bold"
            th:utext="${'<i class=''fa-solid fa-gears me-2''></i>Technologies / ' + (technologyTo.isNew() ? 'Create new' : 'Edit')}">Technologies / Create new</h2>
        <!-- Create/Edit technology card -->
        <div class="row d-flex justify-content-center align-items-center">
            <div class="col-12 col-sm-8 col-md-6 col-xl-5 col-xxl-4">
                <div class="card shadow">
                    <div class="card-header">
                        <h3 class="text-center" th:text="${technologyTo.isNew()} ? 'New technology' : 'Edit: ' + ${technologyTo.name}">Create/Edit technology</h3>
                    </div>
                    <form th:action="@{/references/technologies}" method="post" th:object="${technologyTo}" enctype="multipart/form-data">
                        <div class="card-body p-4 pt-4 pb-3 text-center">
                            <input type="hidden" th:field="*{id}">
                            <div class="mb-3">
                                <div class="input-group">
                                    <span class="input-group-text">Name</i></span>
                                        <input type="text" id="nameInput" th:field="*{name}"
                                               th:class="${#fields.hasErrors('name')} ? 'form-control is-invalid' : 'form-control'"
                                               required placeholder="Name" />
                                </div>
                                <span th:if="${#fields.hasErrors('name')}">
                                        <ul>
                                            <li class="text-danger text-start" th:each="err : ${#fields.errors('name')}"
                                                th:text="${err}"/>
                                        </ul>
                                    </span>
                            </div>
                            <div class="mb-3">
                                <div class="input-group">
                                    <span class="input-group-text">URL&nbsp;&nbsp;&nbsp;</span>
                                        <input type="text" id="hrefInput" th:field="*{url}"
                                               th:class="${#fields.hasErrors('url')} ? 'form-control is-invalid' : 'form-control'"
                                               required placeholder="Official website URL" />
                                </div>
                                <span th:if="${#fields.hasErrors('url')}">
                                        <ul>
                                            <li class="text-danger text-start" th:each="err : ${#fields.errors('url')}"
                                                th:text="${err}"/>
                                        </ul>
                                    </span>
                            </div>
                            <div class="mb-3">
                                <div class="input-group">
                                    <span class="input-group-text">Priority</span>
                                    <select class="form-control selectpicker border" data-style="btn-white"
                                            id="selector2" th:field="*{priority}" title="Priority" required>
                                        <option th:each="priority : ${priorities}"
                                                th:value="${priority.name}"
                                                th:text="${priority}">
                                        </option>
                                    </select>
                                </div>
                                <span th:if="${#fields.hasErrors('priority')}">
                                    <ul>
                                        <li class="text-danger text-start" th:each="err : ${#fields.errors('priority')}"
                                            th:text="${err}"/>
                                    </ul>
                                </span>
                            </div>
                            <div class="mb-3">
                                <div class="input-group">
                                    <span class="input-group-text">Usage</span>
                                        <select class="form-control selectpicker border" data-style="btn-white"
                                                id="selector" th:field="*{usage}" title="Usage" required>
                                            <option th:each="usage : ${usages}"
                                                    th:value="${usage.name}"
                                                    th:text="${usage}">
                                            </option>
                                        </select>
                                </div>
                                <span th:if="${#fields.hasErrors('usage')}">
                                    <ul>
                                        <li class="text-danger text-start" th:each="err : ${#fields.errors('usage')}"
                                            th:text="${err}"/>
                                    </ul>
                                </span>
                            </div>

                            <div id="fileInputDiv">
                                <div th:if="${imageFile != null}" class="input-group">
                                    <span class="input-group-text doc-card-field">File</span>
                                    <div class="form-control" id="editFileInput">
                                        <a th:href="@{/change-notices/download(fileLink=${file.fileLink})}" th:utext="'<i class=&quot;text-danger fa-solid fa-file-pdf&quot;></i>' + ${file.fileName}" target="_blank" title="Show file">File name</a>
                                        <a tabindex="0" type="button" class="trash-button float-end me-3"
                                           data-bs-toggle="popover" data-bs-trigger="focus" data-bs-title="Delete file?"
                                           data-bs-content="<button class='btn btn-sm btn-secondary ms-3'>Cancel</button>
                                           <button class='btn btn-sm btn-danger' onclick='deleteFile()'>Delete</button>">
                                            <i class="fa-solid fa-trash"></i>
                                        </a>
                                    </div>
                                </div>
                                <div th:if="${imageFile == null}" class="input-group custom-file-button">
                                    <label class="input-group-text bg-light" for="fileInput">Image</label>
                                    <input type="file" accept=".svg,.png" th:field="*{imageFile}"
                                           class="form-control text-muted" id="fileInput" required
                                           onchange="$('#fileInput').removeClass('text-muted')" />
                                    <span th:if="${#fields.hasErrors('imageFile')}">
                                        <ul>
                                            <li class="text-danger text-start"
                                                th:each="err : ${#fields.errors('imageFile')}" th:text="${err}"/>
                                        </ul>
                                    </span>
                                </div>
                            </div>

                        </div>
                        <div class="card-footer text-end pe-4 py-2">
                            <button class="btn btn-secondary" type="button" onclick="cancel()">Cancel</button>
                            <button class="btn btn-primary ms-1" type="submit">Create</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </appMain>

    <ownScript>
        <script src="/js/cancel-button.js?v=1"></script>
        <script src="/js/bootstrap-selector-style.js?v=1"></script>
    </ownScript>
</th:block>
